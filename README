# CesiZen üßò‚Äç‚ôÄÔ∏è

> Application web de gestion du bien-√™tre mental avec exercices de respiration, ressources et suivi personnalis√©.

[![CI/CD Pipeline](https://github.com/ChloeLagarde/CesiZen/actions/workflows/_01_Integration.yaml/badge.svg)](https://github.com/ChloeLagarde/CesiZen/actions)
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=ChloeLagarde_CesiZen&metric=alert_status)](https://sonarcloud.io/project/overview?id=ChloeLagarde_CesiZen)

## üìã Table des mati√®res

- [Description](#-description)
- [Technologies](#Ô∏è-technologies)
- [Architecture](#-architecture)
- [Installation](#-installation)
- [Structure du projet](#-structure-du-projet)
- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [API](#-api)
- [Tests](#-tests)
- [CI/CD](#-cicd)
- [S√©curit√©](#-s√©curit√©)
- [Contribution](#-contribution)

## üéØ Description

**CesiZen** est une application web d√©di√©e au bien-√™tre mental qui offre :

- **Exercices de respiration guid√©s** avec minuteurs interactifs
- **Gestion de ressources** p√©dagogiques (articles, guides, m√©ditations)
- **Syst√®me d'authentification** avec gestion des r√¥les
- **Interface responsive** avec Bootstrap 5
- **API REST** pour l'int√©gration externe

### üë• Utilisateurs cibles

- **Utilisateurs** : Acc√®s aux exercices et ressources
- **Administrateurs** : Gestion compl√®te des utilisateurs et ressources

## üõ†Ô∏è Technologies

### Backend
- **PHP 8.2** - Langage principal
- **MySQL 8.0** - Base de donn√©es
- **PDO** - Couche d'abstraction base de donn√©es

### Frontend
- **HTML5/CSS3** - Structure et styles
- **Bootstrap 5.3** - Framework CSS responsive
- **JavaScript vanilla** - Interactions client

### DevOps & Outils
- **Docker & Docker Compose** - Conteneurisation
- **GitHub Actions** - CI/CD
- **PHPUnit 9.6** - Tests unitaires et d'int√©gration
- **SonarCloud** - Analyse qualit√© code
- **Snyk** - Analyse s√©curit√©
- **Trivy** - Scan vuln√©rabilit√©s containers
- **OWASP ZAP** - Tests s√©curit√© web

## üèó Architecture

### Mod√®le MVC Simplifi√©

```
CesiZen/
‚îú‚îÄ‚îÄ üìÅ vues/           # Interface utilisateur (Views)
‚îú‚îÄ‚îÄ üìÅ controleur/     # Logique m√©tier (Controllers)
‚îú‚îÄ‚îÄ üìÅ config/         # Configuration (Database)
‚îú‚îÄ‚îÄ üìÅ api/           # Endpoints REST
‚îî‚îÄ‚îÄ üìÅ assets/        # Ressources statiques
```

### Diagramme d'architecture

```mermaid
graph TB
    U[Utilisateur] --> V[Vues PHP]
    V --> C[Contr√¥leurs]
    C --> DB[(MySQL)]
    C --> API[API REST]
    
    subgraph "Couches"
        V
        C
        DB
        API
    end
```

## üöÄ Installation

### Pr√©requis

- **PHP 8.2+** avec extensions : `pdo`, `pdo_mysql`, `mysqli`, `mbstring`
- **MySQL 8.0+**
- **Composer** (pour les d√©pendances PHP)
- **Docker & Docker Compose** (recommand√©)

### Option 1 : Installation avec Docker (Recommand√©e)

```bash
# 1. Cloner le projet
git clone https://github.com/ChloeLagarde/CesiZen.git
cd CesiZen

# 2. Copier la configuration
cp .env.example .env

# 3. D√©marrer les services
docker-compose up -d

# 4. Initialiser la base de donn√©es
docker-compose exec database mysql -u root -p < docker-init.sql

# 5. Acc√©der √† l'application
# Web: http://localhost:8000
# PhpMyAdmin: http://localhost:8080
# Adminer: http://20.199.81.128:8080 (production)
```

### Option 2 : Installation locale

```bash
# 1. Cloner et configurer
git clone https://github.com/ChloeLagarde/CesiZen.git
cd CesiZen

# 2. Installer les d√©pendances
composer install

# 3. Configurer la base de donn√©es
mysql -u root -p < "script bdd.sql"

# 4. Configurer le serveur web
# Pointer le DocumentRoot vers /vues/
# Exemple avec Apache/WAMP
```

### Variables d'environnement

```bash
# Base de donn√©es
DB_HOST=database          # localhost pour installation locale
DB_NAME=cesizentest
DB_USER=cesizen
DB_PASS=cesizen123
DB_PORT=3306

# Application
APP_ENV=development
APP_DEBUG=true
APP_URL=http://localhost:8000
```

## üìÅ Structure du projet

```
CesiZen/
‚îú‚îÄ‚îÄ üìÑ README.md
‚îú‚îÄ‚îÄ üìÑ composer.json                 # D√©pendances PHP
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml           # Configuration Docker
‚îú‚îÄ‚îÄ üìÑ Dockerfile                   # Image Docker
‚îú‚îÄ‚îÄ üìÑ phpunit.xml                  # Configuration tests
‚îÇ
‚îú‚îÄ‚îÄ üìÅ .github/workflows/           # CI/CD GitHub Actions
‚îÇ   ‚îú‚îÄ‚îÄ _01_Integration.yaml        # Tests et qualit√©
‚îÇ   ‚îú‚îÄ‚îÄ _02_Canary.yaml            # D√©ploiement canary
‚îÇ   ‚îú‚îÄ‚îÄ 01-1_TestPHP.yaml          # Tests PHP + Docker
‚îÇ   ‚îú‚îÄ‚îÄ 01-2_SonarQube.yaml        # Analyse SonarCloud
‚îÇ   ‚îú‚îÄ‚îÄ 01-3_Snyk.yaml             # Scan s√©curit√© Snyk
‚îÇ   ‚îú‚îÄ‚îÄ 02-2_TrivyScan.yaml        # Scan containers
‚îÇ   ‚îú‚îÄ‚îÄ 02-3_DeployCanary.yaml     # D√©ploiement Azure
‚îÇ   ‚îú‚îÄ‚îÄ 02-4_ZapScan.yaml          # Tests s√©curit√© ZAP
‚îÇ   ‚îî‚îÄ‚îÄ z_Docker-Ghcr.yaml         # Build Docker
‚îÇ
‚îú‚îÄ‚îÄ üìÅ api/                         # API REST
‚îÇ   ‚îú‚îÄ‚îÄ ressources.php              # CRUD ressources
‚îÇ   ‚îî‚îÄ‚îÄ users.php                   # CRUD utilisateurs
‚îÇ
‚îú‚îÄ‚îÄ üìÅ assets/                      # Ressources statiques
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles.css              # Styles Bootstrap custom
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ js/
‚îÇ       ‚îî‚îÄ‚îÄ script.js               # JavaScript interactions
‚îÇ
‚îú‚îÄ‚îÄ üìÅ config/                      # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ database.php                # Connexion DB standard
‚îÇ   ‚îî‚îÄ‚îÄ database_docker.php         # Connexion DB Docker
‚îÇ
‚îú‚îÄ‚îÄ üìÅ controleur/                  # Logique m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ auth.php                    # Authentification
‚îÇ   ‚îú‚îÄ‚îÄ gestionCompte.php           # Gestion profil utilisateur
‚îÇ   ‚îú‚îÄ‚îÄ gestionRespiration.php      # Exercices respiration
‚îÇ   ‚îú‚îÄ‚îÄ gestionRessources.php       # CRUD ressources
‚îÇ   ‚îî‚îÄ‚îÄ gestionUser.php             # CRUD utilisateurs (admin)
‚îÇ
‚îú‚îÄ‚îÄ üìÅ tests/                       # Tests automatis√©s
‚îÇ   ‚îú‚îÄ‚îÄ AuthTest.php                # Tests authentification
‚îÇ   ‚îú‚îÄ‚îÄ DatabaseTest.php            # Tests base de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ IntegrationTest.php         # Tests d'int√©gration
‚îÇ   ‚îî‚îÄ‚îÄ ...                         # Autres tests unitaires
‚îÇ
‚îî‚îÄ‚îÄ üìÅ vues/                        # Interface utilisateur
    ‚îú‚îÄ‚îÄ header.php                  # Menu navigation
    ‚îú‚îÄ‚îÄ index.php                   # Page d'accueil
    ‚îú‚îÄ‚îÄ login.php                   # Connexion
    ‚îú‚îÄ‚îÄ register.php                # Inscription
    ‚îú‚îÄ‚îÄ Exercice.php                # Liste exercices
    ‚îú‚îÄ‚îÄ respiration.php             # Exercice interactif
    ‚îú‚îÄ‚îÄ ressources.php              # Liste ressources
    ‚îú‚îÄ‚îÄ monCompte.php               # Profil utilisateur
    ‚îú‚îÄ‚îÄ vueGestionUser.php          # Admin - Gestion users
    ‚îú‚îÄ‚îÄ vueGestionRessources.php    # Admin - Gestion resources
    ‚îî‚îÄ‚îÄ üìÅ composants/
        ‚îî‚îÄ‚îÄ footer.php              # Pied de page
```

## ‚ú® Fonctionnalit√©s

### üîê Authentification & Autorisation

```php
// Connexion utilisateur
$auth = new Auth();
$result = $auth->login($email, $password);

// V√©rification admin
function verifierAdmin() {
    if (!isset($_SESSION['user']) || $_SESSION['user']['role'] !== 'admin') {
        header("Location: ../vues/login.php");
        exit();
    }
}
```

**R√¥les disponibles :**
- `utilisateur` : Acc√®s exercices et ressources
- `admin` : Gestion compl√®te + acc√®s utilisateur

### ü´Å Exercices de respiration

**Patterns disponibles :**
- **Avanc√© (7-4-8)** : Inspiration 7s, Apn√©e 4s, Expiration 8s
- **Moyen (5-0-5)** : Inspiration 5s, Expiration 5s
- **Simple (4-0-6)** : Inspiration 4s, Expiration 6s

```javascript
// Exemple d'utilisation du minuteur
const respirationTimer = {
    inspiration: 7,
    apnee: 4,
    expiration: 8
};
```

### üìö Gestion des ressources

**Types de ressources :**
- Articles de bien-√™tre
- Guides de m√©ditation
- Exercices de coh√©rence cardiaque
- Ressources p√©dagogiques

**Fonctionnalit√©s :**
- ‚úÖ CRUD complet (admin)
- ‚úÖ Cat√©gorisation
- ‚úÖ Visibilit√© publique/priv√©e
- ‚úÖ Gestion des auteurs

### üë§ Gestion des utilisateurs

**Fonctionnalit√©s admin :**
```php
// Actions disponibles
- ajouterUtilisateur()      // Cr√©er un compte
- modifierUtilisateur()     // Modifier infos
- supprimerUtilisateur()    // Supprimer compte
- activerUtilisateur()      // R√©activer compte
- desactiverUtilisateur()   // D√©sactiver compte
```

**S√©curit√© :**
- Mots de passe hash√©s (PASSWORD_DEFAULT)
- Protection CSRF
- Validation des entr√©es
- Gestion des sessions

## üîå API

### Endpoints disponibles

#### Ressources
```http
GET    /api/ressources.php          # Liste toutes les ressources
GET    /api/ressources.php/3        # R√©cup√®re la ressource ID 3
POST   /api/ressources.php          # Cr√©e une ressource
PUT    /api/ressources.php/3        # Modifie la ressource ID 3
DELETE /api/ressources.php/3        # Supprime la ressource ID 3
```

#### Utilisateurs
```http
GET    /api/users.php               # Liste tous les utilisateurs
GET    /api/users.php/3             # R√©cup√®re l'utilisateur ID 3
POST   /api/users.php               # Cr√©e un utilisateur
PUT    /api/users.php/3             # Modifie l'utilisateur ID 3
DELETE /api/users.php/3             # Supprime l'utilisateur ID 3
```

### Exemples d'utilisation

```javascript
// Cr√©er une ressource
fetch('/api/ressources.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        titre: 'Guide m√©ditation',
        description: 'Guide pour d√©butants',
        lien: 'https://example.com/guide.pdf'
    })
});

// R√©cup√©rer toutes les ressources
fetch('/api/ressources.php')
    .then(response => response.json())
    .then(data => console.log(data));
```

## üß™ Tests

### Types de tests

1. **Tests unitaires** - Composants isol√©s
2. **Tests d'int√©gration** - Interactions entre composants
3. **Tests de s√©curit√©** - OWASP ZAP
4. **Tests de vuln√©rabilit√©s** - Snyk & Trivy

### Lancer les tests

```bash
# Tests unitaires
./vendor/bin/phpunit

# Tests sp√©cifiques
./vendor/bin/phpunit tests/AuthTest.php
./vendor/bin/phpunit tests/IntegrationTest.php

# Tests avec couverture
./vendor/bin/phpunit --coverage-html coverage/

# Nettoyer avant tests
chmod +x tests/clean_test.sh
./tests/clean_test.sh
```

### Configuration PHPUnit

```xml
<!-- phpunit.xml -->
<phpunit bootstrap="vendor/autoload.php" colors="true">
    <testsuites>
        <testsuite name="CesiZen Test Suite">
            <directory>tests</directory>
        </testsuite>
    </testsuites>
    
    <php>
        <env name="DB_HOST" value="127.0.0.1"/>
        <env name="DB_NAME" value="cesizentest"/>
        <env name="DB_USER" value="cesizen"/>
        <env name="DB_PASS" value="cesizen123"/>
    </php>
</phpunit>
```

## üîÑ CI/CD

### Pipeline automatique

```mermaid
graph LR
    A[Push Code] --> B[Tests PHP]
    B --> C[SonarCloud]
    B --> D[Snyk Security]
    C --> E[Build Docker]
    D --> E
    E --> F[Trivy Scan]
    F --> G[Deploy Canary]
    G --> H[ZAP Security Test]
```

### √âtapes du pipeline

1. **Tests PHP** (`01-1_TestPHP.yaml`)
   - Tests unitaires PHPUnit
   - Tests d'int√©gration
   - Couverture de code

2. **Qualit√© Code** (`01-2_SonarQube.yaml`)
   - Analyse statique SonarCloud
   - D√©tection bugs & vuln√©rabilit√©s
   - M√©triques qualit√©

3. **S√©curit√©** (`01-3_Snyk.yaml`)
   - Scan d√©pendances PHP
   - Scan code source
   - Monitoring continu

4. **Build & Deploy** (`_02_Canary.yaml`)
   - Construction image Docker
   - Push vers GitHub Container Registry
   - D√©ploiement canary sur Azure VM

5. **Tests s√©curit√©** (`02-4_ZapScan.yaml`)
   - Scan OWASP ZAP baseline
   - Tests API endpoints
   - Tests interface admin

### D√©ploiement

```bash
# Production (Azure VM)
URL: http://20.199.81.128:8000
Admin: http://20.199.81.128:8080

# Images Docker
Registry: ghcr.io/chloelagarde/cesizen
Tags: latest, canary
```

## üîí S√©curit√©

### Mesures impl√©ment√©es

#### Authentification
```php
// Hash s√©curis√© des mots de passe
$hashedPassword = password_hash($password, PASSWORD_DEFAULT);

// V√©rification
if (password_verify($password, $user['password'])) {
    // Authentifi√©
}
```

#### Protection des sessions
```php
// D√©marrage s√©curis√©
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Validation des permissions
if (!isset($_SESSION['user']) || $_SESSION['user']['role'] !== 'admin') {
    header("Location: login.php");
    exit();
}
```

#### Pr√©vention des injections SQL
```php
// Requ√™tes pr√©par√©es
$stmt = $conn->prepare("SELECT * FROM users WHERE email = ?");
$stmt->execute([$email]);
```

#### Headers de s√©curit√© (API)
```php
header("Access-Control-Allow-Origin: *");
header("Content-Type: application/json; charset=UTF-8");
header("Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS");
```

### Outils de s√©curit√©

- **Snyk** : Scan vuln√©rabilit√©s d√©pendances
- **Trivy** : Scan images Docker
- **OWASP ZAP** : Tests s√©curit√© web automatis√©s
- **SonarCloud** : D√©tection failles de s√©curit√© code

## ü§ù Contribution

### Workflow de d√©veloppement

```bash
# 1. Fork & Clone
git clone https://github.com/VotreUsername/CesiZen.git
cd CesiZen

# 2. Cr√©er une branche feature
git checkout -b feature/nouvelle-fonctionnalite

# 3. D√©velopper & tester
docker-compose up -d
./vendor/bin/phpunit

# 4. Commit & Push
git add .
git commit -m "feat: ajouter nouvelle fonctionnalit√©"
git push origin feature/nouvelle-fonctionnalite

# 5. Cr√©er une Pull Request
```

### Standards de code

#### PHP
- **PSR-12** pour le style de code
- **Commentaires PHPDoc** pour les m√©thodes publiques
- **Validation des entr√©es** syst√©matique
- **Gestion d'erreurs** avec try/catch

#### Base de donn√©es
- **Requ√™tes pr√©par√©es** obligatoires
- **Transactions** pour les op√©rations complexes
- **Index** sur les colonnes fr√©quemment requ√™t√©es

#### Frontend
- **HTML s√©mantique**
- **Bootstrap classes** pour le styling
- **JavaScript vanilla** (pas de jQuery)
- **Responsive design** mobile-first

### Ajouts de fonctionnalit√©s

#### Nouvelle page
```php
// 1. Cr√©er la vue
// vues/nouvelle-page.php
<?php include 'header.php'; ?>
<div class="container">
    <!-- Contenu -->
</div>
<?php include 'composants/footer.php'; ?>

// 2. Ajouter le contr√¥leur si n√©cessaire
// controleur/gestion-nouvelle-fonctionnalite.php

// 3. Ajouter les tests
// tests/NouvelleFonctionnaliteTest.php
```

#### Nouvel endpoint API
```php
// api/nouveau-endpoint.php
<?php
require_once '../config/database.php';

header("Content-Type: application/json; charset=UTF-8");
header("Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS");

$method = $_SERVER['REQUEST_METHOD'];
$conn = Database::connect();

switch ($method) {
    case 'GET':
        // Logique GET
        break;
    case 'POST':
        // Logique POST
        break;
    // ...
}
?>
```

### Issues & Bugs

Avant de signaler un bug :

1. **V√©rifier les logs** Docker : `docker-compose logs`
2. **Reproduire le probl√®me** en local
3. **Tester avec les derni√®res versions**
4. **Fournir les d√©tails** :
   - Version PHP
   - Version navigateur
   - √âtapes pour reproduire
   - Messages d'erreur complets

## üìû Support

- **Issues GitHub** : [github.com/ChloeLagarde/CesiZen/issues](https://github.com/ChloeLagarde/CesiZen/issues)
- **Documentation API** : Disponible dans `/api/`
- **Tests CI/CD** : Consultables dans Actions GitHub

## üìù Licence

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de d√©tails.

---

**CesiZen** - D√©velopp√© avec ‚ù§Ô∏è pour le bien-√™tre mental digital.